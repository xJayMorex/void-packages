# Template file for 'beszel-agent'
pkgname=beszel-agent
version=0.16.1
revision=1
build_style=gnu-makefile
make_build_target="build-agent"
hostmakedepends="go nodejs"
short_desc="Lightweight server monitoring platform agent"
maintainer="xJayMorex <github@johntaylor.hu>"
license="MIT"
homepage="https://github.com/henrygd/beszel"
distfiles="https://github.com/henrygd/beszel/archive/refs/tags/v${version}.tar.gz"
checksum=97d27948f90ccfdee2cbbd27993ceb41e7bdc7636f74ecb2eeb135ec17361b42
system_accounts="_beszel"
make_check=no # tests only works with build-hub target
nocross=yes # aarch64-linux-gnu-gcc: error: unrecognized command-line option '-m64'

export GOFLAGS="-buildmode=pie"

case "${XBPS_TARGET_MACHINE}" in
	aarch64*) _goarch=arm64 ;;
	arm*) _goarch=arm ;;
	i686*) _goarch=386 ;;
	x86_64*) _goarch=amd64 ;;
	ppc64le*) _goarch=ppc64le ;;
	mips*) _goarch=mips ;;
	*) broken="Unsupported architecture ${XBPS_TARGET_MACHINE}" ;;
esac

do_install() {
	vbin build/beszel-agent_linux_${_goarch} ${pkgname}
}

post_install() {
	vlicense LICENSE
	vsv beszel-agent
}
